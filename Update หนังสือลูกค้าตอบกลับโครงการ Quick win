var ss = SpreadsheetApp.openById("XXXXXXXXXXXXX"); //à¹ƒà¸ªà¹ˆ SpreadsheetID à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸‡à¸²à¸™
var sheet = ss.getSheetByName("XXXXXXXXXXXXX"); //à¹ƒà¸Šà¹‰à¸Šà¸·à¹ˆà¸­ Sheet à¸—à¸µà¹ˆà¹€à¸£à¸²à¹ƒà¸Šà¹‰ Send to Line Notify à¸—à¸µà¹ˆà¹€à¸£à¸²à¸•à¸±à¹‰à¸‡à¹„à¸§à¹‰à¸­à¹ˆà¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥

// à¸à¸³à¸«à¸™à¸”à¸„à¹ˆà¸² à¸§à¸±à¸™/à¹€à¸”à¸·à¸­à¸™/à¸›à¸µ
  var date = Utilities.formatDate(new Date(), 'GMT+7', 'dd/MM/');
  var thaiyear = Number(Utilities.formatDate(new Date(), "GMT+7", "yyyy"))+543;
  var today = 'à¸§à¸±à¸™à¸—à¸µà¹ˆ '+date+thaiyear;

// à¸•à¸±à¹‰à¸‡à¹€à¸§à¸¥à¸²à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™
function TimeNotify() {
  
  //à¸à¸³à¸«à¸™à¸”à¸§à¸±à¸™à¸—à¸µà¹ˆà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™
  var  d = new Date(); //Today
  var daycur = d.getDay(); // Sunday - Saturday : 0 - 6
  var datecur = d.getDate(); // Date 1-31
  var HHmm = Utilities.formatDate(new Date(), "Asia/Bangkok", "HH:mm");
  
  // Set send notify every Friday at 15:30.
  var set_day = 5; // Sunday - Saturday : 0 - 6
  var set_HHmm = "15:30";

  //Logger.log(10%2);
  
  if(datecur%2 != 0){
    if(set_day == daycur){
      if(HHmm == set_HHmm){
        sendLineNotify();
      }
    }
  }
  
  // Set send notify every Wendesday at 09:00.
  var set_day2 = 3; // Sunday - Saturday : 0 - 6
  var set_HHmm2 = "09:00";
  
  if(set_day2 == daycur){
     if(HHmm == set_HHmm2){
        UpdateDocCustomerPermit();
     }
  }
}


function onOpen() {
  var ui = SpreadsheetApp.getUi();
  // Or DocumentApp or FormApp.
  ui.createMenu('Custom Menu')
      .addItem('Send Update Progress', 'menuItem1')
      .addItem('Send Update DocCustomerPermit', 'menuItem2')
      .addToUi();
}

function menuItem1() {
  SpreadsheetApp.getUi() // Or DocumentApp or FormApp.
     .alert('The update progress has been sent successfully.!');
  sendLineNotify();
}

function menuItem2() {
  SpreadsheetApp.getUi() // Or DocumentApp or FormApp.
     .alert('The update progress has been sent successfully.!');
  UpdateDocCustomerPermit();
}

function sendLineNotify() {

   //======= à¸à¸³à¸«à¸™à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸§à¸±à¸™à¸—à¸µà¹ˆà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ ===========//
     var d = new Date();                   //à¸à¸³à¸«à¸™à¸” d à¹€à¸à¹‡à¸šà¸§à¸±à¸™à¸—à¸µà¹ˆà¸§à¸±à¸™à¸™à¸µà¹‰
     var d_today = d.getDate();            // à¸§à¸±à¸™à¸—à¸µà¹ˆ
     var m_today = d.getMonth()+1;         //à¹€à¸¥à¸‚à¹€à¸”à¸·à¸­à¸™ 0-11 à¹€à¸à¸·à¹ˆà¸­à¹„à¸›à¸«à¸² à¸¡à¸à¸£à¸²à¸„à¸¡-à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡
     var y_today = d.getFullYear()+543;    //à¹€à¸à¸´à¹ˆà¸¡à¸›à¸µ à¸„.à¸¨. à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™ à¸.à¸¨.
     var hh_today = d.getHours();          //à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡
     var mm_today = d.getMinutes();        //à¸™à¸²à¸—à¸µ
     var ss_today = d.getSeconds();        //à¸§à¸´à¸™à¸²à¸—à¸µ
     var day_timestamp = d_today + "/" + m_today + "/" + y_today + ", " + hh_today + ":" + mm_today + ":" + ss_today;
     var day_today = d_today + "/" + m_today + "/" + y_today;

  var userDay = "ğŸ—“à¸§à¸±à¸™à¸—à¸µà¹ˆ "+day_today;
  //var values = sheet.getRange(4, 2, sheet.getLastRow(),sheet.getLastColumn()).getValues();
  var Data1 = sheet.getRange(4,2).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§
  //var Data2 = sheet.getRange(4,4).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§
  //var Data3 = sheet.getRange(4,5).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§
  var Data4 = sheet.getRange(4,6).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§
  var Data5 = sheet.getRange(4,7).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§
  
  var Data1A = sheet.getRange(6,2).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ 1
  //var Data2A = sheet.getRange(6,4).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ 1
  //var Data3A = sheet.getRange(6,5).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ 1
  var Data4A = sheet.getRange(6,6).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ 1
  var Data5A = sheet.getRange(6,7).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ 1
  
  var Data1B = sheet.getRange(10,2).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ 2
  //var Data2B = sheet.getRange(10,4).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ 2
  //var Data3B = sheet.getRange(10,5).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ 2
  var Data4B = sheet.getRange(10,6).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ 2
  var Data5B = sheet.getRange(10,7).getValue(); // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸²à¸¢à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ 2
  
  var DataS1 = sheet.getRange(12,2).getValue(); // à¸ˆà¸³à¸™à¸§à¸™à¸¥à¸¹à¸à¸„à¹‰à¸²à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¹‚à¸„à¸£à¸‡à¸à¸²à¸£
  var DataS2 = sheet.getRange(12,6).getValue(); // à¸ˆà¸³à¸™à¸§à¸™à¸¥à¸¹à¸à¸„à¹‰à¸²à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸—à¸µà¹ˆà¸•à¸­à¸šà¸£à¸±à¸šà¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¹à¸šà¸šà¸à¹ˆà¸­à¸ªà¸£à¹‰à¸²à¸‡
  var DataS3 = sheet.getRange(12,7).getValue(); // %à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¹‚à¸„à¸£à¸‡à¸à¸²à¸£
  
  var Line1 = "ğŸ“£ à¸ªà¸£à¸¸à¸› Update ğŸ“£\nà¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸‚à¸­à¸­à¸™à¸¸à¸à¸²à¸•à¸à¹ˆà¸­à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¸­à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸² à¹‚à¸„à¸£à¸‡à¸à¸²à¸£ Quick win\n" + userDay + "\n\n";
  var Line2 = "ğŸŸ¢ğŸšˆà¸ªà¸²à¸¢à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§ :\n";
  var Line3 = " - à¸¡à¸µà¸ˆà¸³à¸™à¸§à¸™à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” " + Data1 + " à¸£à¸²à¸¢\n";
  //var Line4 = " - à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸£à¸±à¸šà¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸ˆà¸²à¸ à¸à¸Ÿà¸™. " + Data2 + " à¸£à¸²à¸¢\n";
  //var Line5 = " - à¸ªà¹ˆà¸‡à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¯à¹ƒà¸«à¹‰à¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸¥à¹‰à¸§ " + Data3 + " à¸£à¸²à¸¢\n";
  var Line6 = " - à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸µà¹ˆà¸•à¸­à¸šà¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¯à¹à¸¥à¹‰à¸§ " + Data4 + " à¸£à¸²à¸¢\n";
  var Line6A = "   (à¸„à¸´à¸”à¹€à¸›à¹‡à¸™ " + Data5 + "%)\n\n";
  
  var Line7 = "ğŸŸ£ğŸšˆà¸ªà¸²à¸¢à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ 1 :\n";
  var Line8 = " - à¸¡à¸µà¸ˆà¸³à¸™à¸§à¸™à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” " + Data1A + " à¸£à¸²à¸¢\n";
  //var Line9 = " - à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸£à¸±à¸šà¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸ˆà¸²à¸ à¸à¸Ÿà¸™. " + Data2A + " à¸£à¸²à¸¢\n";
  //var Line10 = " - à¸ªà¹ˆà¸‡à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¯à¹ƒà¸«à¹‰à¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸¥à¹‰à¸§ " + Data3A + " à¸£à¸²à¸¢\n";
  var Line11 = " - à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸µà¹ˆà¸•à¸­à¸šà¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¯à¹à¸¥à¹‰à¸§ " + Data4A + " à¸£à¸²à¸¢\n";
  var Line11A = "   (à¸„à¸´à¸”à¹€à¸›à¹‡à¸™ " + Data5A + "%)\n\n";
  
  var Line12 = "ğŸŸ£ğŸšˆà¸ªà¸²à¸¢à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ 2 :\n";
  var Line13 = " - à¸¡à¸µà¸ˆà¸³à¸™à¸§à¸™à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” " + Data1B + " à¸£à¸²à¸¢\n";
  //var Line14 = " - à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸£à¸±à¸šà¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸ˆà¸²à¸ à¸à¸Ÿà¸™. " + Data2B + " à¸£à¸²à¸¢\n";
  //var Line15 = " - à¸ªà¹ˆà¸‡à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¯à¹ƒà¸«à¹‰à¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸¥à¹‰à¸§ " + Data3B + " à¸£à¸²à¸¢\n";
  var Line16 = " - à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸µà¹ˆà¸•à¸­à¸šà¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¯à¹à¸¥à¹‰à¸§ " + Data4B + " à¸£à¸²à¸¢\n";
  var Line16A = "   (à¸„à¸´à¸”à¹€à¸›à¹‡à¸™ " + Data5B + "%)\n\n";
  
  var Line17 = "ğŸ¢ à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” " + DataS1 + " à¸£à¸²à¸¢\n";
  var Line18 = "ğŸ“„ à¸£à¸§à¸¡à¸•à¸­à¸šà¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¯ " + DataS2 + " à¸£à¸²à¸¢\n";
  var Line19 = "ğŸ“ˆ à¸„à¸´à¸”à¹€à¸›à¹‡à¸™ " + DataS3 + "% à¸‚à¸­à¸‡à¸—à¸±à¹‰à¸‡à¹‚à¸„à¸£à¸‡à¸à¸²à¸£ğŸ˜†\n\n";
  var Line20 = "ğŸ“ŒğŸ“ŒğŸ“ŒğŸ“ŒğŸ“ŒğŸ“ŒğŸ“ŒğŸ“ŒğŸ“Œ";
  
  var title = Line1;
  //var green = Line2 + Line3 + Line4 + Line5 + Line6 + Line6A;
  var green = Line2 + Line3 + Line6 + Line6A;
  //var purple1 = Line7 + Line8 + Line9 + Line10 + Line11 + Line11A;
  var purple1 = Line7 + Line8 + Line11 + Line11A;
  //var purple2 = Line12 + Line13 + Line14 + Line15 + Line16 + Line16A;
  var purple2 = Line12 + Line13 + Line16 + Line16A;
  var bottom = Line17 + Line18 + Line19 + Line20;

  var messages = {
        "message": title + green + purple1 + purple2 + bottom,
        "stickerPackageId": "1",
        "stickerId": "2"
      };
  
  var token = ["XXXXXXXXXXXXX"];
               
  for(var i = 0; i<token.length; i++){
    var options = {
      "method": "post",
      "payload": messages,
      "headers": {
        "Authorization": "Bearer " + token[i]
       }
    };
  
    UrlFetchApp.fetch("https://notify-api.line.me/api/notify", options);
  }
}

function UpdateDocCustomerPermit() {

   //======= à¸à¸³à¸«à¸™à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸§à¸±à¸™à¸—à¸µà¹ˆà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ ===========//
     var d = new Date();                   //à¸à¸³à¸«à¸™à¸” d à¹€à¸à¹‡à¸šà¸§à¸±à¸™à¸—à¸µà¹ˆà¸§à¸±à¸™à¸™à¸µà¹‰
     var d_today = d.getDate();            // à¸§à¸±à¸™à¸—à¸µà¹ˆ
     var m_today = d.getMonth()+1;         //à¹€à¸¥à¸‚à¹€à¸”à¸·à¸­à¸™ 0-11 à¹€à¸à¸·à¹ˆà¸­à¹„à¸›à¸«à¸² à¸¡à¸à¸£à¸²à¸„à¸¡-à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡
     var y_today = d.getFullYear()+543;    //à¹€à¸à¸´à¹ˆà¸¡à¸›à¸µ à¸„.à¸¨. à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™ à¸.à¸¨.
     var hh_today = d.getHours();          //à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡
     var mm_today = d.getMinutes();        //à¸™à¸²à¸—à¸µ
     var ss_today = d.getSeconds();        //à¸§à¸´à¸™à¸²à¸—à¸µ
     var day_timestamp = d_today + "/" + m_today + "/" + y_today + ", " + hh_today + ":" + mm_today + ":" + ss_today;
     var day_today = d_today + "/" + m_today + "/" + y_today;

  var userDay = "ğŸ—“à¸§à¸±à¸™à¸—à¸µà¹ˆ "+day_today;
  
  var Line1 = "\nà¹€à¸£à¸µà¸¢à¸™ à¸—à¸µà¸¡à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸›à¸£à¸¶à¸à¸©à¸²\n\n";
  var Line2 = "      à¸£à¸šà¸à¸§à¸™ Update à¸ªà¸–à¸²à¸™à¸°à¸‚à¸­à¸‡à¸à¸²à¸£à¸•à¸­à¸šà¸à¸¥à¸±à¸šà¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸‚à¸­à¸­à¸™à¸¸à¸à¸²à¸•à¸à¹ˆà¸­à¸ªà¸£à¹‰à¸²à¸‡à¹ƒà¸™à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆà¸‚à¸­à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²à¸‚à¸­à¸‡à¹à¸•à¹ˆà¸¥à¸°à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡ à¸•à¸²à¸¡ Link à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡à¸™à¸µà¹‰à¸„à¸£à¸±à¸šğŸ‘‡ğŸ»\n\n";
  var Line3 = "https://docs.google.com/spreadsheets/d/XXXXXXXXXXXXX";
  
  var Line4 = "\n      à¹à¸¥à¸°à¸Šà¹ˆà¸§à¸¢ Upload File à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸•à¸­à¸šà¸à¸¥à¸±à¸šà¸ˆà¸²à¸à¸¥à¸¹à¸à¸„à¹‰à¸²à¹„à¸§à¹‰à¹ƒà¸™ Google drive à¸•à¸²à¸¡ Link à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡à¸™à¸µà¹‰à¸”à¹‰à¸§à¸¢à¸„à¸£à¸±à¸šğŸ‘‡ğŸ»\n\n";
  var Line5 = "https://drive.google.com/drive/folders/XXXXXXXXXXXXX";
  var Line6 = "\n\n"+"à¸‚à¸­à¸šà¸„à¸¸à¸“à¸„à¸£à¸±à¸š";
  
  var title = Line1;
  var body1 = Line2 + Line3;
  var body2 = Line4 + Line5 + Line6;
  
  var messages1 = {
        "message": title + body1
      };
  var messages2 = {
        "message": body2
      };
      
  var token = ["XXXXXXXXXXXXX"];
               
  for(var i = 0; i<token.length; i++){
    var options = {
      "method": "post",
      "payload": messages1,
      "headers": {
        "Authorization": "Bearer " + token[i]
       }
    };
  
    UrlFetchApp.fetch("https://notify-api.line.me/api/notify", options);
  }
  
  for(var i = 0; i<token.length; i++){
    var options = {
      "method": "post",
      "payload": messages2,
      "headers": {
        "Authorization": "Bearer " + token[i]
       }
    };
  
    UrlFetchApp.fetch("https://notify-api.line.me/api/notify", options);
  }
}
